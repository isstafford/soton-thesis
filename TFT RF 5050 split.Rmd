---
title: "Random Forest for Predicting TFT Assay Results from Oxidative Stress Genes "
author: "Imogen Stafford"
date: "14/10/2019"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Load Packages from Library 

```{r}
library(caret)
library(tidyverse)
library(randomForest)
library(gbm)
```


#Load up and Configure Data

```{r}
rosdata <- read.delim("//filestore.soton.ac.uk/users/iss1g18/mydocuments/PhD/ROS Analysis/Data Files/rosdatanew.txt")

MyVars <- c( "tft_norm_z","NOX1", "CYBA", "CYBB", "NCF2","NCF4",  "RAC2",
             "DUOX2", "NOXA1","NOXO1", "DUOXA1", "DUOXA2", "DUOX1", "NOX3", "NOX4", "NOX5")

mldata <- na.omit(rosdata[MyVars])
```

#Label FRAP assay results as "high", "mid", "low". Make a new column in the dataframe for this information.

```{r}
mldata$tft_bin <- mldata$tft_norm_z
mldata$tft_bin[mldata$tft_norm_z > quantile(mldata$tft_norm_z, probs = 0.5)] <- print("high")
mldata$tft_bin[mldata$tft_norm_z <= quantile(mldata$tft_norm_z, probs = 0.5)] <- print("low")
mldata$tft_bin <- as.factor(mldata$tft_bin)

#Check categories are in their correct proportion
summary(mldata$tft_bin)

#Remove frap z-scores
mldata <- mldata[,-1]

#Remove data in "mid" category
data <- subset(mldata, tft_bin=="high" | tft_bin=="low")

#remove mid level
data$tft_bin <- factor(data$tft_bin)
summary(data$tft_bin)

```

#FRAP model: remove midpoindata splitting

```{r}
#begin data partition
set.seed(23)
trainIndex <- createDataPartition(data$tft_bin, p = .65, 
                                  list = FALSE, 
                                  times = 1)
head(trainIndex)

tftTrain <- data[ trainIndex,]
tftTest  <- data[-trainIndex,]
summary(tftTrain$tft_bin)
summary(tftTest$tft_bin)

```

#Random Forest Model Training

```{r}
set.seed(23)
#method="rf"
fitControl <- trainControl (##10-fold CV
  method = "repeatedcv",
  number=10,
  repeats=10)

#Mtry <- sqrt(ncol(fraTrain))
#tuneGrid <- expand.grid(.mtry=mtry)
set.seed(23)
rfFit <- train(tft_bin ~ ., data = tftTrain, method ="rf", metric="Accuracy",Mtry=6, trControl = fitControl)
plot(rfFit)

#summary(rfFit)

#method="gbm"
set.seed(23)
gbmGrid <-  expand.grid(interaction.depth = c(1, 5, 9), 
                        n.trees = (1:30)*50, 
                        shrinkage = 0.1,
                        n.minobsinnode = 20)

gbmFit2 <- train(tft_bin ~ ., data = tftTrain, 
                 method = "gbm", 
                 trControl = fitControl, 
                 verbose = FALSE, 
                 ## Now specify the exact models 
                 ## to evaluate:
                 tuneGrid = gbmGrid)
plot(gbmFit2)
```